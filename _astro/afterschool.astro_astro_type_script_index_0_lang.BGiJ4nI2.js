import{g as m,a as r,f as w,s as b,b as h}from"./profile.BzHqYqaP.js";import"./aes.Ce_Q33qD.js";function g(){const n=r(),t=document.getElementById("display-name");t&&(t.textContent=h(n))}g();document.getElementById("login-btn")?.addEventListener("click",()=>window.showLoginModal());window.addEventListener("user-logged-in",()=>g());const a=document.getElementById("afterschool-form"),f=document.getElementById("submit-progress"),u=document.getElementById("progress-text");a?.addEventListener("submit",async n=>{n.preventDefault();let t=m(),s=r();if((!t||!s)&&(window.showProfileModal(),await new Promise(e=>window.addEventListener("profile-created",e,{once:!0})),t=m(),s=r()),!t||!s){alert("Failed to create profile. Please try again.");return}const l=new FormData(a),i={},c=[];l.getAll("activities").forEach(e=>c.push(e)),l.forEach((e,d)=>{d==="activities"?i.activities=c.join(", "):e&&(i[d]=e)});const p={profile:s,formType:"Afterschool Program Registration",formData:i,email:i.email},y=w(p);f?.classList.remove("hidden");const o=a.querySelector('button[type="submit"]');o&&(o.disabled=!0),await b(t.secretKey,y,e=>{u&&(u.textContent=e)})?(!localStorage.getItem("has_submitted")?(window.showNsecModal(t.nsec),localStorage.setItem("has_submitted","true")):alert("Registration submitted successfully!"),a.reset()):alert("Failed to submit. Please check your connection and try again."),f?.classList.add("hidden"),o&&(o.disabled=!1)});
