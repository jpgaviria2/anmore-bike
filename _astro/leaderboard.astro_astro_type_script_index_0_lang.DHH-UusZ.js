import{c as un,a as ye,b as Ze,d as te,e as Xe,u as G,f as dn,g as rt,h as _e,i as hn,j as fn,k as pn,s as ne,l as E,m as x,n as X,o as ee,p as ce,q as Se,r as it,t as st,v as J,w as gn}from"./aes.Ce_Q33qD.js";const at=e=>Uint8Array.from(e.split(""),t=>t.charCodeAt(0)),yn=at("expand 16-byte k"),mn=at("expand 32-byte k"),vn=G(yn),wn=G(mn);function g(e,t){return e<<t|e>>>32-t}function xe(e){return e.byteOffset%4===0}const re=64,bn=16,ot=2**32-1,Ye=Uint32Array.of();function En(e,t,n,r,i,s,a,o){const c=i.length,u=new Uint8Array(re),l=G(u),h=xe(i)&&xe(s),d=h?G(i):Ye,f=h?G(s):Ye;for(let p=0;p<c;a++){if(e(t,n,r,l,a,o),a>=ot)throw new Error("arx: counter overflow");const y=Math.min(re,c-p);if(h&&y===re){const w=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let m=0,b;m<bn;m++)b=w+m,f[b]=d[b]^l[m];p+=re;continue}for(let w=0,m;w<y;w++)m=p+w,s[m]=i[m]^u[w];p+=y}}function xn(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:s,rounds:a}=un({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return ye(i),ye(a),Ze(s),Ze(n),(o,c,u,l,h=0)=>{te(o,void 0,"key"),te(c,void 0,"nonce"),te(u,void 0,"data");const d=u.length;if(l===void 0&&(l=new Uint8Array(d)),te(l,void 0,"output"),ye(h),h<0||h>=ot)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);const f=[];let p=o.length,y,w;if(p===32)f.push(y=Xe(o)),w=wn;else if(p===16&&n)y=new Uint8Array(32),y.set(o),y.set(o,16),w=vn,f.push(y);else throw te(o,32,"arx key"),new Error("invalid key size");xe(c)||f.push(c=Xe(c));const m=G(y);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(w,m,G(c.subarray(0,16)),m),c=c.subarray(16)}const b=16-i;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const j=new Uint8Array(12);j.set(c,s?0:12-c.length),c=j,f.push(c)}const W=G(c);return En(e,w,m,W,u,l,h,a),dn(...f),l}}function _n(e,t,n,r,i,s=20){let a=e[0],o=e[1],c=e[2],u=e[3],l=t[0],h=t[1],d=t[2],f=t[3],p=t[4],y=t[5],w=t[6],m=t[7],b=i,W=n[0],j=n[1],Je=n[2],S=a,k=o,R=c,T=u,C=l,A=h,L=d,P=f,I=p,N=y,M=w,O=m,U=b,B=W,$=j,F=Je;for(let Ke=0;Ke<s;Ke+=2)S=S+C|0,U=g(U^S,16),I=I+U|0,C=g(C^I,12),S=S+C|0,U=g(U^S,8),I=I+U|0,C=g(C^I,7),k=k+A|0,B=g(B^k,16),N=N+B|0,A=g(A^N,12),k=k+A|0,B=g(B^k,8),N=N+B|0,A=g(A^N,7),R=R+L|0,$=g($^R,16),M=M+$|0,L=g(L^M,12),R=R+L|0,$=g($^R,8),M=M+$|0,L=g(L^M,7),T=T+P|0,F=g(F^T,16),O=O+F|0,P=g(P^O,12),T=T+P|0,F=g(F^T,8),O=O+F|0,P=g(P^O,7),S=S+A|0,F=g(F^S,16),M=M+F|0,A=g(A^M,12),S=S+A|0,F=g(F^S,8),M=M+F|0,A=g(A^M,7),k=k+L|0,U=g(U^k,16),O=O+U|0,L=g(L^O,12),k=k+L|0,U=g(U^k,8),O=O+U|0,L=g(L^O,7),R=R+P|0,B=g(B^R,16),I=I+B|0,P=g(P^I,12),R=R+P|0,B=g(B^R,8),I=I+B|0,P=g(P^I,7),T=T+C|0,$=g($^T,16),N=N+$|0,C=g(C^N,12),T=T+C|0,$=g($^T,8),N=N+$|0,C=g(C^N,7);let _=0;r[_++]=a+S|0,r[_++]=o+k|0,r[_++]=c+R|0,r[_++]=u+T|0,r[_++]=l+C|0,r[_++]=h+A|0,r[_++]=d+L|0,r[_++]=f+P|0,r[_++]=p+I|0,r[_++]=y+N|0,r[_++]=w+M|0,r[_++]=m+O|0,r[_++]=b+U|0,r[_++]=W+B|0,r[_++]=j+$|0,r[_++]=Je+F|0}const ct=xn(_n,{counterRight:!1,counterLength:4,allowShortKeys:!1});function Sn(e,t,n){return rt(e),n===void 0&&(n=new Uint8Array(e.outputLen)),_e(e,n,t)}const me=Uint8Array.of(0),Qe=Uint8Array.of();function kn(e,t,n,r=32){rt(e),hn(r,"length");const i=e.outputLen;if(r>255*i)throw new Error("Length must be <= 255*HashLen");const s=Math.ceil(r/i);n===void 0?n=Qe:fn(n,void 0,"info");const a=new Uint8Array(s*i),o=_e.create(e,t),c=o._cloneInto(),u=new Uint8Array(o.outputLen);for(let l=0;l<s;l++)me[0]=l+1,c.update(l===0?Qe:u).update(n).update(me).digestInto(u),a.set(u,i*l),o._cloneInto(c);return o.destroy(),c.destroy(),pn(u,me),a.slice(0,r)}var Rn=Object.defineProperty,v=(e,t)=>{for(var n in t)Rn(e,n,{get:t[n],enumerable:!0})},Z=Symbol("verified"),Tn=e=>e instanceof Object;function ke(e){if(!Tn(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var Cn={};v(Cn,{binarySearch:()=>Re,bytesToHex:()=>E,hexToBytes:()=>x,insertEventIntoAscendingList:()=>Ln,insertEventIntoDescendingList:()=>An,mergeReverseSortedLists:()=>Pn,normalizeURL:()=>Y,utf8Decoder:()=>V,utf8Encoder:()=>H});var V=new TextDecoder("utf-8"),H=new TextEncoder;function Y(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function An(e,t){const[n,r]=Re(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:i.created_at-t.created_at);return r||e.splice(n,0,t),e}function Ln(e,t){const[n,r]=Re(e,i=>t.id===i.id?0:t.created_at===i.created_at?-1:t.created_at-i.created_at);return r||e.splice(n,0,t),e}function Re(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=Math.floor((n+r)/2),s=t(e[i]);if(s===0)return[i,!0];s<0?r=i-1:n=i+1}return[n,!1]}function Pn(e,t){const n=new Array(e.length+t.length);n.length=0;let r=0,i=0,s=[];for(;r<e.length&&i<t.length;){let a;if(e[r]?.created_at>t[i]?.created_at?(a=e[r],r++):(a=t[i],i++),n.length>0&&n[n.length-1].created_at===a.created_at){if(s.includes(a.id))continue}else s.length=0;n.push(a),s.push(a.id)}for(;r<e.length;){const a=e[r];if(r++,n.length>0&&n[n.length-1].created_at===a.created_at){if(s.includes(a.id))continue}else s.length=0;n.push(a),s.push(a.id)}for(;i<t.length;){const a=t[i];if(i++,n.length>0&&n[n.length-1].created_at===a.created_at){if(s.includes(a.id))continue}else s.length=0;n.push(a),s.push(a.id)}return n}var In=class{generateSecretKey(){return ne.utils.randomSecretKey()}getPublicKey(e){return E(ne.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=E(ne.getPublicKey(t)),n.id=se(n),n.sig=E(ne.sign(x(se(n)),t)),n[Z]=!0,n}verifyEvent(e){if(typeof e[Z]=="boolean")return e[Z];const t=se(e);if(t!==e.id)return e[Z]=!1,!1;try{const n=ne.verify(x(e.sig),x(t),x(e.pubkey));return e[Z]=n,n}catch{return e[Z]=!1,!1}}};function Nn(e){if(!ke(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function se(e){let t=X(H.encode(Nn(e)));return E(t)}var le=new In,Mn=le.generateSecretKey,Te=le.getPublicKey,q=le.finalizeEvent,ue=le.verifyEvent,On={};v(On,{Application:()=>Gr,BadgeAward:()=>Dn,BadgeDefinition:()=>Hr,BlockedRelaysList:()=>xr,BlossomServerList:()=>Ar,BookmarkList:()=>wr,Bookmarksets:()=>Br,Calendar:()=>ei,CalendarEventRSVP:()=>ti,ChannelCreation:()=>pt,ChannelHideMessage:()=>mt,ChannelMessage:()=>yt,ChannelMetadata:()=>gt,ChannelMuteUser:()=>vt,ChatMessage:()=>zn,ClassifiedListing:()=>Zr,ClientAuth:()=>bt,Comment:()=>Qn,CommunitiesList:()=>br,CommunityDefinition:()=>si,CommunityPostApproval:()=>or,Contacts:()=>Hn,CreateOrUpdateProduct:()=>Dr,CreateOrUpdateStall:()=>qr,Curationsets:()=>$r,Date:()=>Yr,DirectMessageRelaysList:()=>Tr,DraftClassifiedListing:()=>Xr,DraftLong:()=>Vr,Emojisets:()=>jr,EncryptedDirectMessage:()=>Wn,EventDeletion:()=>qn,FavoriteRelays:()=>Sr,FileMessage:()=>jn,FileMetadata:()=>Yn,FileServerPreference:()=>Cr,Followsets:()=>Mr,ForumThread:()=>Vn,GenericRepost:()=>Ie,Genericlists:()=>Or,GiftWrap:()=>wt,GroupMetadata:()=>ai,HTTPAuth:()=>Ne,Handlerinformation:()=>ii,Handlerrecommendation:()=>ri,Highlights:()=>pr,InterestsList:()=>kr,Interestsets:()=>Wr,JobFeedback:()=>ur,JobRequest:()=>cr,JobResult:()=>lr,Label:()=>ar,LightningPubRPC:()=>Pr,LiveChatMessage:()=>er,LiveEvent:()=>Jr,LongFormArticle:()=>zr,Metadata:()=>$n,Mutelist:()=>yr,NWCWalletInfo:()=>Lr,NWCWalletRequest:()=>Et,NWCWalletResponse:()=>Ir,NormalVideo:()=>Jn,NostrConnect:()=>Nr,OpenTimestamps:()=>Zn,Photo:()=>Gn,Pinlist:()=>mr,Poll:()=>Xn,PollResponse:()=>gr,PrivateDirectMessage:()=>ft,ProblemTracker:()=>rr,ProfileBadges:()=>Fr,PublicChatsList:()=>Er,Reaction:()=>Pe,RecommendRelay:()=>Fn,RelayList:()=>vr,RelayReview:()=>ni,Relaysets:()=>Ur,Report:()=>ir,Reporting:()=>sr,Repost:()=>Le,Seal:()=>ht,SearchRelaysList:()=>_r,ShortTextNote:()=>dt,ShortVideo:()=>Kn,Time:()=>Qr,UserEmojiList:()=>Rr,UserStatuses:()=>Kr,Voice:()=>tr,VoiceComment:()=>nr,Zap:()=>fr,ZapGoal:()=>dr,ZapRequest:()=>hr,classifyKind:()=>Un,isAddressableKind:()=>Ae,isEphemeralKind:()=>ut,isKind:()=>Bn,isRegularKind:()=>lt,isReplaceableKind:()=>Ce});function lt(e){return e<1e4&&e!==0&&e!==3}function Ce(e){return e===0||e===3||1e4<=e&&e<2e4}function ut(e){return 2e4<=e&&e<3e4}function Ae(e){return 3e4<=e&&e<4e4}function Un(e){return lt(e)?"regular":Ce(e)?"replaceable":ut(e)?"ephemeral":Ae(e)?"parameterized":"unknown"}function Bn(e,t){const n=t instanceof Array?t:[t];return ke(e)&&n.includes(e.kind)||!1}var $n=0,dt=1,Fn=2,Hn=3,Wn=4,qn=5,Le=6,Pe=7,Dn=8,zn=9,Vn=11,ht=13,ft=14,jn=15,Ie=16,Gn=20,Jn=21,Kn=22,pt=40,gt=41,yt=42,mt=43,vt=44,Zn=1040,wt=1059,Xn=1068,Yn=1063,Qn=1111,er=1311,tr=1222,nr=1244,rr=1971,ir=1984,sr=1984,ar=1985,or=4550,cr=5999,lr=6999,ur=7e3,dr=9041,hr=9734,fr=9735,pr=9802,gr=1018,yr=1e4,mr=10001,vr=10002,wr=10003,br=10004,Er=10005,xr=10006,_r=10007,Sr=10012,kr=10015,Rr=10030,Tr=10050,Cr=10096,Ar=10063,Lr=13194,Pr=21e3,bt=22242,Et=23194,Ir=23195,Nr=24133,Ne=27235,Mr=3e4,Or=30001,Ur=30002,Br=30003,$r=30004,Fr=30008,Hr=30009,Wr=30015,qr=30017,Dr=30018,zr=30023,Vr=30024,jr=30030,Gr=30078,Jr=30311,Kr=30315,Zr=30402,Xr=30403,Yr=31922,Qr=31923,ei=31924,ti=31925,ni=31987,ri=31989,ii=31990,si=34550,ai=39e3;function oi(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),i=e[`#${r}`];if(i&&!t.tags.find(([s,a])=>s===n.slice(1)&&i.indexOf(a)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function ci(e,t){for(let n=0;n<e.length;n++)if(oi(e[n],t))return!0;return!1}var li={};v(li,{getHex64:()=>de,getInt:()=>xt,getSubscriptionId:()=>_t,matchEventId:()=>ui,matchEventKind:()=>hi,matchEventPubkey:()=>di});function de(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function xt(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),s=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,s),10)}function _t(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(i===-1)return null;let s=r+1+i;return e.slice(r+1,s)}function ui(e,t){return t===de(e,"id")}function di(e,t){return t===de(e,"pubkey")}function hi(e,t){return t===xt(e,"kind")}var fi={};v(fi,{makeAuthEvent:()=>St});function St(e,t){return{kind:bt,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}var kt=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Rt=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);onauth;baseEoseTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;idleSince=Date.now();ongoingOperations=0;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;skipReconnection=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Y(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing,this.enableReconnect=t.enableReconnect||!1}static async connect(e,t){const n=new Rt(e,t);return await n.connect(t),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const e=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},e)}handleHardClose(e){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0,this.idleSince=void 0,this.enableReconnect&&!this.skipReconnection?this.reconnect():(this.onclose?.(),this.closeAllSubscriptions(e))}async connect(e){let t;return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.skipReconnection=!1,this.connectionPromise=new Promise((n,r)=>{e?.timeout&&(t=setTimeout(()=>{r("connection timed out"),this.connectionPromise=void 0,this.skipReconnection=!0,this.onclose?.(),this.handleHardClose("relay connection timed out")},e.timeout)),e?.abort&&(e.abort.onabort=r);try{this.ws=new this._WebSocket(this.url)}catch(i){clearTimeout(t),r(i);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(t),this._connected=!0;const i=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const s of this.openSubs.values()){if(s.eosed=!1,i)for(let a=0;a<s.filters.length;a++)s.lastEmitted&&(s.filters[a].since=s.lastEmitted+1);s.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),n()},this.ws.onerror=()=>{clearTimeout(t),r("connection failed"),this.connectionPromise=void 0,this.skipReconnection=!0,this.onclose?.(),this.handleHardClose("relay connection failed")},this.ws.onclose=i=>{clearTimeout(t),r(i.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(e=>{this.ws.once("pong",()=>e(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((e,t)=>{if(!this.connectionPromise)return t(new Error(`no connection to ${this.url}, can't ping`));try{const n=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"<forced-ping>",oneose:()=>{e(!0),n.close()},onclose(){e(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(n){t(n)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async send(e){if(!this.connectionPromise)throw new kt(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){const t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,r)=>{try{let i=await e(St(this.url,t)),s=setTimeout(()=>{let a=this.openEventPublishes.get(i.id);a&&(a.reject(new Error("auth timed out")),this.openEventPublishes.delete(i.id))},this.publishTimeout);this.openEventPublishes.set(i.id,{resolve:n,reject:r,timeout:s}),this.send('["AUTH",'+JSON.stringify(i)+"]")}catch(i){console.warn("subscribe auth function failed:",i)}}),this.authPromise)}async publish(e){this.idleSince=void 0,this.ongoingOperations++;const t=new Promise((n,r)=>{const i=setTimeout(()=>{const s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:r,timeout:i})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),this.ongoingOperations--,this.ongoingOperations===0&&(this.idleSince=Date.now()),t}async count(e,t){this.serial++;const n=t?.id||"count:"+this.serial,r=new Promise((i,s)=>{this.openCountRequests.set(n,{resolve:i,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){t.label!=="<forced-ping>"&&(this.idleSince=void 0,this.ongoingOperations++);const n=this.prepareSubscription(e,t);return n.fire(),t.abort&&(t.abort.onabort=()=>n.close(String(t.abort.reason||"<aborted>"))),n}prepareSubscription(e,t){this.serial++;const n=t.id||(t.label?t.label+":":"sub:")+this.serial,r=new pi(this,n,e,t);return this.openSubs.set(n,r),r}close(){this.skipReconnection=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.idleSince=void 0,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(e){const t=e.data;if(!t)return;const n=_t(t);if(n){const r=this.openSubs.get(n);if(!r)return;const i=de(t,"id"),s=r.alreadyHaveEvent?.(i);if(r.receivedEvent?.(this,i),s)return}try{let r=JSON.parse(t);switch(r[0]){case"EVENT":{const i=this.openSubs.get(r[1]),s=r[2];this.verifyEvent(s)&&ci(i.filters,s)&&i.onevent(s),(!i.lastEmitted||i.lastEmitted<s.created_at)&&(i.lastEmitted=s.created_at);return}case"COUNT":{const i=r[1],s=r[2],a=this.openCountRequests.get(i);a&&(a.resolve(s.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(r[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=r[1],s=r[2],a=r[3],o=this.openEventPublishes.get(i);o&&(clearTimeout(o.timeout),s?o.resolve(a):o.reject(new Error(a)),this.openEventPublishes.delete(i));return}case"CLOSED":{const i=r[1],s=this.openSubs.get(i);if(!s)return;s.closed=!0,s.close(r[2]);return}case"NOTICE":{this.onnotice(r[1]);return}case"AUTH":{this.challenge=r[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(r[1])?.oncustom?.(r);return}}}catch(r){const[i,s,a]=JSON.parse(t);window.printer.maybe(a.pubkey,":: caught err",a,this.url,r);return}}},pi=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(e,t,n,r){if(n.length===0)throw new Error("subscription can't be created with zero filters");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(i=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,i)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof kt))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.relay.ongoingOperations--,this.relay.ongoingOperations===0&&(this.relay.idleSince=Date.now()),this.onclose?.(e)}},gi;try{gi=WebSocket}catch{}var yi=e=>(e[Z]=!0,!0),mi=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;onRelayConnectionFailure;onRelayConnectionSuccess;allowConnectingToRelay;maxWaitForConnection;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation,this.enablePing=e.enablePing,this.enableReconnect=e.enableReconnect||!1,this.automaticallyAuth=e.automaticallyAuth,this.onRelayConnectionFailure=e.onRelayConnectionFailure,this.onRelayConnectionSuccess=e.onRelayConnectionSuccess,this.allowConnectingToRelay=e.allowConnectingToRelay,this.maxWaitForConnection=e.maxWaitForConnection||3e3}async ensureRelay(e,t){e=Y(e);let n=this.relays.get(e);if(n||(n=new Rt(e,{verifyEvent:this.trustedRelayURLs.has(e)?yi:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),n.onclose=()=>{this.relays.delete(e)},this.relays.set(e,n)),this.automaticallyAuth){const r=this.automaticallyAuth(e);r&&(n.onauth=r)}try{await n.connect({timeout:t?.connectionTimeout,abort:t?.abort})}catch(r){throw this.relays.delete(e),r}return n}close(e){e.map(Y).forEach(t=>{this.relays.get(t)?.close(),this.relays.delete(t)})}subscribe(e,t,n){const r=[],i=[];for(let s=0;s<e.length;s++){const a=Y(e[s]);r.find(o=>o.url===a)||i.indexOf(a)===-1&&(i.push(a),r.push({url:a,filter:t}))}return this.subscribeMap(r,n)}subscribeMany(e,t,n){return this.subscribe(e,t,n)}subscribeMap(e,t){const n=new Map;for(const d of e){const{url:f,filter:p}=d;n.has(f)||n.set(f,[]),n.get(f).push(p)}const r=Array.from(n.entries()).map(([d,f])=>({url:d,filters:f}));this.trackRelays&&(t.receivedEvent=(d,f)=>{let p=this.seenOn.get(f);p||(p=new Set,this.seenOn.set(f,p)),p.add(d)});const i=new Set,s=[],a=[];let o=d=>{a[d]||(a[d]=!0,a.filter(f=>f).length===r.length&&(t.oneose?.(),o=()=>{}))};const c=[];let u=(d,f)=>{c[d]||(o(d),c[d]=f,c.filter(p=>p).length===r.length&&(t.onclose?.(c),u=()=>{}))};const l=d=>{if(t.alreadyHaveEvent?.(d))return!0;const f=i.has(d);return i.add(d),f},h=Promise.all(r.map(async({url:d,filters:f},p)=>{if(this.allowConnectingToRelay?.(d,["read",f])===!1){u(p,"connection skipped by allowConnectingToRelay");return}let y;try{y=await this.ensureRelay(d,{connectionTimeout:this.maxWaitForConnection<(t.maxWait||0)?Math.max(t.maxWait*.8,t.maxWait-1e3):this.maxWaitForConnection,abort:t.abort})}catch(m){this.onRelayConnectionFailure?.(d),u(p,m?.message||String(m));return}this.onRelayConnectionSuccess?.(d);let w=y.subscribe(f,{...t,oneose:()=>o(p),onclose:m=>{m.startsWith("auth-required: ")&&t.onauth?y.auth(t.onauth).then(()=>{y.subscribe(f,{...t,oneose:()=>o(p),onclose:b=>{u(p,b)},alreadyHaveEvent:l,eoseTimeout:t.maxWait,abort:t.abort})}).catch(b=>{u(p,`auth was required and attempted, but failed with: ${b}`)}):u(p,m)},alreadyHaveEvent:l,eoseTimeout:t.maxWait,abort:t.abort});s.push(w)}));return{async close(d){await h,s.forEach(f=>{f.close(d)})}}}subscribeEose(e,t,n){const r=this.subscribe(e,t,{...n,oneose(){r.close("closed automatically on eose")}});return r}subscribeManyEose(e,t,n){return this.subscribeEose(e,t,n)}async querySync(e,t,n){return new Promise(async r=>{const i=[];this.subscribeEose(e,t,{...n,onevent(s){i.push(s)},onclose(s){r(i)}})})}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort((i,s)=>s.created_at-i.created_at),r[0]||null}publish(e,t,n){return e.map(Y).map(async(r,i,s)=>{if(s.indexOf(r)!==i)return Promise.reject("duplicate url");if(this.allowConnectingToRelay?.(r,["write",t])===!1)return Promise.reject("connection skipped by allowConnectingToRelay");let a;try{a=await this.ensureRelay(r,{connectionTimeout:this.maxWaitForConnection<(n?.maxWait||0)?Math.max(n.maxWait*.8,n.maxWait-1e3):this.maxWaitForConnection,abort:n?.abort})}catch(o){return this.onRelayConnectionFailure?.(r),"connection failure: "+String(o)}return a.publish(t).catch(async o=>{if(o instanceof Error&&o.message.startsWith("auth-required: ")&&n?.onauth)return await a.auth(n.onauth),a.publish(t);throw o}).then(o=>{if(this.trackRelays){let c=this.seenOn.get(t.id);c||(c=new Set,this.seenOn.set(t.id,c)),c.add(a)}return o})})}listConnectionStatus(){const e=new Map;return this.relays.forEach((t,n)=>e.set(n,t.connected)),e}destroy(){this.relays.forEach(e=>e.close()),this.relays=new Map}pruneIdleRelays(e=1e4){const t=[];for(const[n,r]of this.relays)r.idleSince&&Date.now()-r.idleSince>=e&&(this.relays.delete(n),t.push(n),r.close());return t}},Tt;try{Tt=WebSocket}catch{}var vi=class extends mi{constructor(e){super({verifyEvent:ue,websocketImplementation:Tt,maxWaitForConnection:3e3,...e})}},Me={};v(Me,{BECH32_REGEX:()=>Ct,Bech32MaxSize:()=>Oe,NostrTypeGuard:()=>wi,decode:()=>he,decodeNostrURI:()=>Ei,encodeBytes:()=>pe,naddrEncode:()=>Ti,neventEncode:()=>Ri,noteEncode:()=>Si,nprofileEncode:()=>ki,npubEncode:()=>_i,nsecEncode:()=>xi});var wi={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},Oe=5e3,Ct=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function bi(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Ei(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),he(e)}catch{return{type:"invalid",data:null}}}function he(e){let{prefix:t,words:n}=ee.decode(e,Oe),r=new Uint8Array(ee.fromWords(n));switch(t){case"nprofile":{let i=ve(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:E(i[0][0]),relays:i[1]?i[1].map(s=>V.decode(s)):[]}}}case"nevent":{let i=ve(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for nevent");if(i[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(i[2]&&i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(i[3]&&i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:E(i[0][0]),relays:i[1]?i[1].map(s=>V.decode(s)):[],author:i[2]?.[0]?E(i[2][0]):void 0,kind:i[3]?.[0]?parseInt(E(i[3][0]),16):void 0}}}case"naddr":{let i=ve(r);if(!i[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!i[2]?.[0])throw new Error("missing TLV 2 for naddr");if(i[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!i[3]?.[0])throw new Error("missing TLV 3 for naddr");if(i[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:V.decode(i[0][0]),pubkey:E(i[2][0]),kind:parseInt(E(i[3][0]),16),relays:i[1]?i[1].map(s=>V.decode(s)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:E(r)};default:throw new Error(`unknown prefix ${t}`)}}function ve(e){let t={},n=e;for(;n.length>0;){let r=n[0],i=n[1],s=n.slice(2,2+i);if(n=n.slice(2+i),s.length<i)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function xi(e){return pe("nsec",e)}function _i(e){return pe("npub",x(e))}function Si(e){return pe("note",x(e))}function fe(e,t){let n=ee.toWords(t);return ee.encode(e,n,Oe)}function pe(e,t){return fe(e,t)}function ki(e){let t=Ue({0:[x(e.pubkey)],1:(e.relays||[]).map(n=>H.encode(n))});return fe("nprofile",t)}function Ri(e){let t;e.kind!==void 0&&(t=bi(e.kind));let n=Ue({0:[x(e.id)],1:(e.relays||[]).map(r=>H.encode(r)),2:e.author?[x(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return fe("nevent",n)}function Ti(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=Ue({0:[H.encode(e.identifier)],1:(e.relays||[]).map(r=>H.encode(r)),2:[x(e.pubkey)],3:[new Uint8Array(t)]});return fe("naddr",n)}function Ue(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(i=>{let s=new Uint8Array(i.length+2);s.set([parseInt(n)],0),s.set([i.length],1),s.set(i,2),t.push(s)})}),ce(...t)}var Ci={};v(Ci,{decrypt:()=>Ai,encrypt:()=>At});function At(e,t,n){const r=e instanceof Uint8Array?e:x(e),i=Se.getSharedSecret(r,x("02"+t)),s=Lt(i);let a=Uint8Array.from(it(16)),o=H.encode(n),c=st(s,a).encrypt(o),u=J.encode(new Uint8Array(c)),l=J.encode(new Uint8Array(a.buffer));return`${u}?iv=${l}`}function Ai(e,t,n){const r=e instanceof Uint8Array?e:x(e);let[i,s]=n.split("?iv="),a=Se.getSharedSecret(r,x("02"+t)),o=Lt(a),c=J.decode(s),u=J.decode(i),l=st(o,c).decrypt(u);return V.decode(l)}function Lt(e){return e.slice(1,33)}var Li={};v(Li,{NIP05_REGEX:()=>Be,isNip05:()=>Pi,isValid:()=>Mi,queryProfile:()=>Pt,searchDomain:()=>Ni,useFetchImplementation:()=>Ii});var Be=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,Pi=e=>Be.test(e||""),ge;try{ge=fetch}catch{}function Ii(e){ge=e}async function Ni(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await ge(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Pt(e){const t=e.match(Be);if(!t)return null;const[,n="_",r]=t;try{const i=`https://${r}/.well-known/nostr.json?name=${n}`,s=await ge(i,{redirect:"manual"});if(s.status!==200)throw Error("Wrong response code");const a=await s.json(),o=a.names[n];return o?{pubkey:o,relays:a.relays?.[o]}:null}catch{return null}}async function Mi(e,t){const n=await Pt(t);return n?n.pubkey===e:!1}var Oi={};v(Oi,{parse:()=>Ui});function Ui(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let i=e.tags.length-1;i>=0;i--){const s=e.tags[i];if(s[0]==="e"&&s[1]){const[a,o,c,u,l]=s,h={id:o,relays:c?[c]:[],author:l};if(u==="root"){t.root=h;continue}if(u==="reply"){t.reply=h;continue}if(u==="mention"){t.mentions.push(h);continue}n?r=h:n=h,t.mentions.push(h);continue}if(s[0]==="q"&&s[1]){const[a,o,c]=s;t.quotes.push({id:o,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(i=>{if(!i)return;let s=t.mentions.indexOf(i);if(s!==-1&&t.mentions.splice(s,1),i.author){let a=t.profiles.find(o=>o.pubkey===i.author);a&&a.relays&&(i.relays||(i.relays=[]),a.relays.forEach(o=>{i.relays?.indexOf(o)===-1&&i.relays.push(o)}),a.relays=i.relays)}}),t.mentions.forEach(i=>{if(i.author){let s=t.profiles.find(a=>a.pubkey===i.author);s&&s.relays&&(i.relays||(i.relays=[]),s.relays.forEach(a=>{i.relays.indexOf(a)===-1&&i.relays.push(a)}),s.relays=i.relays)}}),t}var Bi={};v(Bi,{fetchRelayInformation:()=>Fi,useFetchImplementation:()=>$i});var It;try{It=fetch}catch{}function $i(e){It=e}async function Fi(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var Hi={};v(Hi,{fastEventHash:()=>Mt,getPow:()=>Nt,minePow:()=>Wi});function Nt(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function Wi(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),i[1]=(++n).toString(),r.id=Mt(r),Nt(r.id)>=t)break}return r}function Mt(e){return E(X(H.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var qi={};v(qi,{unwrapEvent:()=>es,unwrapManyEvents:()=>ts,wrapEvent:()=>Gt,wrapManyEvents:()=>Qi});var Di={};v(Di,{createRumor:()=>Dt,createSeal:()=>zt,createWrap:()=>Vt,unwrapEvent:()=>qe,unwrapManyEvents:()=>jt,wrapEvent:()=>oe,wrapManyEvents:()=>Xi});var zi={};v(zi,{decrypt:()=>We,encrypt:()=>He,getConversationKey:()=>$e,v2:()=>Ki});var Ot=1,Ut=65535;function $e(e,t){const n=Se.getSharedSecret(e,x("02"+t)).subarray(1,33);return Sn(X,n,H.encode("nip44-v2"))}function Bt(e,t){const n=kn(X,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Fe(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function Vi(e){if(!Number.isSafeInteger(e)||e<Ot||e>Ut)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function ji(e){const t=H.encode(e),n=t.length,r=Vi(n),i=new Uint8Array(Fe(n)-n);return ce(r,t,i)}function Gi(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<Ot||t>Ut||n.length!==t||e.length!==2+Fe(t))throw new Error("invalid padding");return V.decode(n)}function $t(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=ce(n,t);return _e(X,e,r)}function Ji(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=J.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const i=n[0];if(i!==2)throw new Error("unknown encryption version "+i);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function He(e,t,n=it(32)){const{chacha_key:r,chacha_nonce:i,hmac_key:s}=Bt(t,n),a=ji(e),o=ct(r,i,a),c=$t(s,o,n);return J.encode(ce(new Uint8Array([2]),n,o,c))}function We(e,t){const{nonce:n,ciphertext:r,mac:i}=Ji(e),{chacha_key:s,chacha_nonce:a,hmac_key:o}=Bt(t,n),c=$t(o,r,n);if(!gn(c,i))throw new Error("invalid MAC");const u=ct(s,a,r);return Gi(u)}var Ki={utils:{getConversationKey:$e,calcPaddedLen:Fe},encrypt:He,decrypt:We},Zi=2880*60,Ft=()=>Math.round(Date.now()/1e3),Ht=()=>Math.round(Ft()-Math.random()*Zi),Wt=(e,t)=>$e(e,t),qt=(e,t,n)=>He(JSON.stringify(e),Wt(t,n)),et=(e,t)=>JSON.parse(We(e.content,Wt(t,e.pubkey)));function Dt(e,t){const n={created_at:Ft(),content:"",tags:[],...e,pubkey:Te(t)};return n.id=se(n),n}function zt(e,t,n){return q({kind:ht,content:qt(e,t,n),created_at:Ht(),tags:[]},t)}function Vt(e,t){const n=Mn();return q({kind:wt,content:qt(e,n,t),created_at:Ht(),tags:[["p",t]]},n)}function oe(e,t,n){const r=Dt(e,t),i=zt(r,t,n);return Vt(i,n)}function Xi(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Te(t),i=[oe(e,t,r)];return n.forEach(s=>{i.push(oe(e,t,s))}),i}function qe(e,t){const n=et(e,t);return et(n,t)}function jt(e,t){let n=[];return e.forEach(r=>{n.push(qe(r,t))}),n.sort((r,i)=>r.created_at-i.created_at),n}function Yi(e,t,n,r){const i={created_at:Math.ceil(Date.now()/1e3),kind:ft,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:a,relayUrl:o})=>{i.tags.push(o?["p",a,o]:["p",a])}),r&&i.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&i.tags.push(["subject",n]),i}function Gt(e,t,n,r,i){const s=Yi(t,n,r,i);return oe(s,e,t.publicKey)}function Qi(e,t,n,r,i){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Te(e)},...t].map(a=>Gt(e,a,n,r,i))}var es=qe,ts=jt,ns={};v(ns,{finishRepostEvent:()=>rs,getRepostedEvent:()=>is,getRepostedEventPointer:()=>Jt});function rs(e,t,n,r){let i;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===dt?i=Le:(i=Ie,s.push(["k",String(t.kind)])),q({kind:i,tags:s,content:e.content===""||t.tags?.find(a=>a[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function Jt(e){if(![Le,Ie].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(t!==void 0)return{id:t[1],relays:[t[2],n?.[2]].filter(r=>typeof r=="string"),author:n?.[1]}}function is(e,{skipVerification:t}={}){const n=Jt(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!ue(r)))return r}var ss={};v(ss,{NOSTR_URI_REGEX:()=>De,parse:()=>os,test:()=>as});var De=new RegExp(`nostr:(${Ct.source})`);function as(e){return typeof e=="string"&&new RegExp(`^${De.source}$`).test(e)}function os(e){const t=e.match(new RegExp(`^${De.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:he(t[1])}}var cs={};v(cs,{finishReactionEvent:()=>ls,getReactedEventPointer:()=>us});function ls(e,t,n){const r=t.tags.filter(i=>i.length>=2&&(i[0]==="e"||i[0]==="p"));return q({...e,kind:Pe,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function us(e){if(e.kind!==Pe)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const i=e.tags[r];i.length>=2&&(i[0]==="e"&&t===void 0?t=i:i[0]==="p"&&n===void 0&&(n=i))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var ds={};v(ds,{parse:()=>fs});var we=/\W/m,tt=/[^\w\/] |[^\w\/]$|$|,| /m,hs=42;function*fs(e){let t=[];if(typeof e!="string"){for(let s=0;s<e.tags.length;s++){const a=e.tags[s];a[0]==="emoji"&&a.length>=3&&t.push({type:"emoji",shortcode:a[1],url:a[2]})}e=e.content}const n=e.length;let r=0,i=0;e:for(;i<n;){const s=e.indexOf(":",i),a=e.indexOf("#",i);if(s===-1&&a===-1)break e;if(s===-1||a>=0&&a<s){if(a===0||e[a-1].match(we)){const o=e.slice(a+1,a+hs).match(we),c=o?a+1+o.index:n;yield{type:"text",text:e.slice(r,a)},yield{type:"hashtag",value:e.slice(a+1,c)},i=c,r=i;continue e}i=a+1;continue e}if(e.slice(s-5,s)==="nostr"){const o=e.slice(s+60).match(we),c=o?s+60+o.index:n;try{let u,{data:l,type:h}=he(e.slice(s+1,c));switch(h){case"npub":u={pubkey:l};break;case"note":u={id:l};break;case"nsec":i=c+1;continue;default:u=l}r!==s-5&&(yield{type:"text",text:e.slice(r,s-5)}),yield{type:"reference",pointer:u},i=c,r=i;continue e}catch{i=s+1;continue e}}else if(e.slice(s-5,s)==="https"||e.slice(s-4,s)==="http"){const o=e.slice(s+4).match(tt),c=o?s+4+o.index:n,u=e[s-1]==="s"?5:4;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid url");if(r!==s-u&&(yield{type:"text",text:e.slice(r,s-u)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(l.pathname)){yield{type:"image",url:l.toString()},i=c,r=i;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(l.pathname)){yield{type:"video",url:l.toString()},i=c,r=i;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(l.pathname)){yield{type:"audio",url:l.toString()},i=c,r=i;continue e}yield{type:"url",url:l.toString()},i=c,r=i;continue e}catch{i=c+1;continue e}}else if(e.slice(s-3,s)==="wss"||e.slice(s-2,s)==="ws"){const o=e.slice(s+4).match(tt),c=o?s+4+o.index:n,u=e[s-1]==="s"?3:2;try{let l=new URL(e.slice(s-u,c));if(l.hostname.indexOf(".")===-1)throw new Error("invalid ws url");r!==s-u&&(yield{type:"text",text:e.slice(r,s-u)}),yield{type:"relay",url:l.toString()},i=c,r=i;continue e}catch{i=c+1;continue e}}else{for(let o=0;o<t.length;o++){const c=t[o];if(e[s+c.shortcode.length+1]===":"&&e.slice(s+1,s+c.shortcode.length+1)===c.shortcode){r!==s&&(yield{type:"text",text:e.slice(r,s)}),yield c,i=s+c.shortcode.length+2,r=i;continue e}}i=s+1;continue e}}r!==n&&(yield{type:"text",text:e.slice(r)})}var ps={};v(ps,{channelCreateEvent:()=>gs,channelHideMessageEvent:()=>vs,channelMessageEvent:()=>ms,channelMetadataEvent:()=>ys,channelMuteUserEvent:()=>ws});var gs=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return q({kind:pt,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},ys=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return q({kind:gt,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},ms=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),q({kind:yt,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},vs=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return q({kind:mt,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},ws=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return q({kind:vt,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},bs={};v(bs,{EMOJI_SHORTCODE_REGEX:()=>Kt,matchAll:()=>Es,regex:()=>ze,replaceAll:()=>xs});var Kt=/:(\w+):/,ze=()=>new RegExp(`\\B${Kt.source}\\B`,"g");function*Es(e){const t=e.matchAll(ze());for(const n of t)try{const[r,i]=n;yield{shortcode:r,name:i,start:n.index,end:n.index+r.length}}catch{}}function xs(e,t){return e.replaceAll(ze(),(n,r)=>t({shortcode:n,name:r}))}var _s={};v(_s,{useFetchImplementation:()=>Ss,validateGithub:()=>ks});var Ve;try{Ve=fetch}catch{}function Ss(e){Ve=e}async function ks(e,t,n){try{return await(await Ve(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var Rs={};v(Rs,{makeNwcRequestEvent:()=>Cs,parseConnectionString:()=>Ts});function Ts(e){const{host:t,pathname:n,searchParams:r}=new URL(e),i=n||t,s=r.get("relay"),a=r.get("secret");if(!i||!s||!a)throw new Error("invalid connection string");return{pubkey:i,relay:s,secret:a}}async function Cs(e,t,n){const i=At(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Et,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]};return q(s,t)}var As={};v(As,{normalizeIdentifier:()=>Ls});function Ls(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var Ps={};v(Ps,{getSatoshisAmountFromBolt11:()=>Bs,getZapEndpoint:()=>Ns,makeZapReceipt:()=>Us,makeZapRequest:()=>Ms,useFetchImplementation:()=>Is,validateZapRequest:()=>Os});var je;try{je=fetch}catch{}function Is(e){je=e}async function Ns(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(r){let[a,o]=r.split("@");t=new URL(`/.well-known/lnurlp/${a}`,`https://${o}`).toString()}else if(n){let{words:a}=ee.decode(n,1e3),o=ee.fromWords(a);t=V.decode(o)}else return null;let s=await(await je(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function Ms(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),Ce(e.event.kind)){const n=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(n)}else if(Ae(e.event.kind)){let n=e.event.tags.find(([i,s])=>i==="d"&&s);if(!n)throw new Error("d tag not found or is empty");const r=["a",`${e.event.kind}:${e.event.pubkey}:${n[1]}`];t.tags.push(r)}t.tags.push(["k",e.event.kind.toString()])}return t}function Os(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!ke(t))return"Zap request is not a valid Nostr event.";if(!ue(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,a])=>s==="p"&&a);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,a])=>s==="e"&&a);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,a])=>s==="relays"&&a)?null:"Zap request doesn't have a 'relays' tag."}function Us({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e),s=i.tags.filter(([o])=>o==="e"||o==="p"||o==="a"),a={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",i.pubkey],["bolt11",n],["description",e]]};return t&&a.tags.push(["preimage",t]),a}function Bs(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const n=e.substring(0,t);if(!n.startsWith("lnbc"))return 0;const r=n.substring(4);if(r.length<1)return 0;const i=r[r.length-1],s=i.charCodeAt(0)-48,a=s>=0&&s<=9;let o=r.length-1;if(a&&o++,o<1)return 0;const c=parseInt(r.substring(0,o));switch(i){case"m":return c*1e5;case"u":return c*100;case"n":return c/10;case"p":return c/1e4;default:return c*1e8}}var $s={};v($s,{Negentropy:()=>Xt,NegentropyStorageVector:()=>Ws,NegentropySync:()=>qs});var be=97,Q=32,Zt=16,K={Skip:0,Fingerprint:1,IdList:2},z=class{_raw;length;constructor(e){typeof e=="number"?(this._raw=new Uint8Array(e),this.length=0):e instanceof Uint8Array?(this._raw=new Uint8Array(e),this.length=e.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(e){if(e instanceof z&&(e=e.unwrap()),typeof e.length!="number")throw Error("bad length");const t=e.length+this.length;if(this.capacity<t){const n=this._raw,r=Math.max(this.capacity*2,t);this._raw=new Uint8Array(r),this._raw.set(n)}this._raw.set(e,this.length),this.length+=e.length}shift(){const e=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,e}shiftN(e=1){const t=this._raw.subarray(0,e);return this._raw=this._raw.subarray(e),this.length-=e,t}};function ie(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let n=e.shift();if(t=t<<7|n&127,(n&128)===0)break}return t}function D(e){if(e===0)return new z(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let n=0;n<t.length-1;n++)t[n]|=128;return new z(new Uint8Array(t))}function Fs(e){return ae(e,1)[0]}function ae(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var Hs=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(Q)}add(e){let t=0,n=0,r=new DataView(this.buf.buffer),i=new DataView(e.buffer);for(let s=0;s<8;s++){let a=s*4,o=r.getUint32(a,!0),c=i.getUint32(a,!0),u=o;u+=t,u+=c,u>4294967295&&(n=1),r.setUint32(a,u&4294967295,!0),t=n,n=0}}negate(){let e=new DataView(this.buf.buffer);for(let n=0;n<8;n++){let r=n*4;e.setUint32(r,~e.getUint32(r,!0))}let t=new Uint8Array(Q);t[0]=1,this.add(t)}getFingerprint(e){let t=new z;return t.extend(this.buf),t.extend(D(e)),X(t.unwrap()).subarray(0,Zt)}},Ws=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(e,t){if(this.sealed)throw Error("already sealed");const n=x(t);if(n.byteLength!==Q)throw Error("bad id size for added item");this.items.push({timestamp:e,id:n})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(Ee);for(let e=1;e<this.items.length;e++)if(Ee(this.items[e-1],this.items[e])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(e){if(this._checkSealed(),e>=this.items.length)throw Error("out of range");return this.items[e]}iterate(e,t,n){this._checkSealed(),this._checkBounds(e,t);for(let r=e;r<t&&n(this.items[r],r);++r);}findLowerBound(e,t,n){return this._checkSealed(),this._checkBounds(e,t),this._binarySearch(this.items,e,t,r=>Ee(r,n)<0)}fingerprint(e,t){let n=new Hs;return n.setToZero(),this.iterate(e,t,r=>(n.add(r.id),!0)),n.getFingerprint(t-e)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(e,t){if(e>t||t>this.items.length)throw Error("bad range")}_binarySearch(e,t,n,r){let i=n-t;for(;i>0;){let s=t,a=Math.floor(i/2);s+=a,r(e[s])?(t=++s,i-=a+1):i=a}return t}},Xt=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(e,t=6e4){if(t<4096)throw Error("frameSizeLimit too small");this.storage=e,this.frameSizeLimit=t,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(e,t){return{timestamp:e,id:t||new Uint8Array(0)}}initiate(){let e=new z;return e.extend(new Uint8Array([be])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),e),E(e.unwrap())}reconcile(e,t,n){const r=new z(x(e));this.lastTimestampIn=this.lastTimestampOut=0;let i=new z;i.extend(new Uint8Array([be]));let s=Fs(r);if(s<96||s>111)throw Error("invalid negentropy protocol version byte");if(s!==be)throw Error("unsupported negentropy protocol version requested: "+(s-96));let a=this.storage.size(),o=this._bound(0),c=0,u=!1;for(;r.length!==0;){let l=new z,h=()=>{u&&(u=!1,l.extend(this.encodeBound(o)),l.extend(D(K.Skip)))},d=this.decodeBound(r),f=ie(r),p=c,y=this.storage.findLowerBound(c,a,d);if(f===K.Skip)u=!0;else if(f===K.Fingerprint){let w=ae(r,Zt),m=this.storage.fingerprint(p,y);Yt(w,m)!==0?(h(),this.splitRange(p,y,d,l)):u=!0}else if(f===K.IdList){let w=ie(r),m={};for(let b=0;b<w;b++){let W=ae(r,Q);m[E(W)]=W}if(u=!0,this.storage.iterate(p,y,b=>{let W=b.id;const j=E(W);return m[j]?delete m[E(W)]:t?.(j),!0}),n)for(let b of Object.values(m))n(E(b))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(i.length+l.length)){let w=this.storage.fingerprint(y,a);i.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),i.extend(D(K.Fingerprint)),i.extend(w);break}else i.extend(l);c=y,o=d}return i.length===1?null:E(i.unwrap())}splitRange(e,t,n,r){let i=t-e,s=16;if(i<s*2)r.extend(this.encodeBound(n)),r.extend(D(K.IdList)),r.extend(D(i)),this.storage.iterate(e,t,a=>(r.extend(a.id),!0));else{let a=Math.floor(i/s),o=i%s,c=e;for(let u=0;u<s;u++){let l=a+(u<o?1:0),h=this.storage.fingerprint(c,c+l);c+=l;let d;if(c===t)d=n;else{let f,p;this.storage.iterate(c-1,c+1,(y,w)=>(w===c-1?f=y:p=y,!0)),d=this.getMinimalBound(f,p)}r.extend(this.encodeBound(d)),r.extend(D(K.Fingerprint)),r.extend(h)}}}exceededFrameSizeLimit(e){return e>this.frameSizeLimit-200}decodeTimestampIn(e){let t=ie(e);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(e){let t=this.decodeTimestampIn(e),n=ie(e);if(n>Q)throw Error("bound key too long");let r=ae(e,n);return{timestamp:t,id:r}}encodeTimestampOut(e){if(e===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,D(0);let t=e;return e-=this.lastTimestampOut,this.lastTimestampOut=t,D(e+1)}encodeBound(e){let t=new z;return t.extend(this.encodeTimestampOut(e.timestamp)),t.extend(D(e.id.length)),t.extend(e.id),t}getMinimalBound(e,t){if(t.timestamp!==e.timestamp)return this._bound(t.timestamp);{let n=0,r=t.id,i=e.id;for(let s=0;s<Q&&r[s]===i[s];s++)n++;return this._bound(t.timestamp,t.id.subarray(0,n+1))}}};function Yt(e,t){for(let n=0;n<e.byteLength;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function Ee(e,t){return e.timestamp===t.timestamp?Yt(e.id,t.id):e.timestamp-t.timestamp}var qs=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(e,t,n,r={}){this.relay=e,this.storage=t,this.neg=new Xt(t),this.onhave=r.onhave,this.onneed=r.onneed,this.filter=n,this.subscription=this.relay.prepareSubscription([{}],{label:r.label||"negentropy"}),this.subscription.oncustom=i=>{switch(i[0]){case"NEG-MSG":{i.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${i}`);try{const s=this.neg.reconcile(i[2],this.onhave,this.onneed);s?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${s}"]`):(this.close(),r.onclose?.())}catch(s){console.error("negentropy reconcile error:",s),r?.onclose?.(`reconcile error: ${s}`)}break}case"NEG-CLOSE":{const s=i[2];console.warn("negentropy error:",s),r.onclose?.(s);break}case"NEG-ERR":r.onclose?.()}}}async start(){const e=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${e}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},Ds={};v(Ds,{getToken:()=>zs,hashPayload:()=>Ge,unpackEventFromToken:()=>en,validateEvent:()=>on,validateEventKind:()=>nn,validateEventMethodTag:()=>sn,validateEventPayloadTag:()=>an,validateEventTimestamp:()=>tn,validateEventUrlTag:()=>rn,validateToken:()=>Vs});var Qt="Nostr ";async function zs(e,t,n,r=!1,i){const s={kind:Ne,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};i&&s.tags.push(["payload",Ge(i)]);const a=await n(s);return(r?Qt:"")+J.encode(H.encode(JSON.stringify(a)))}async function Vs(e,t,n){const r=await en(e).catch(s=>{throw s});return await on(r,t,n).catch(s=>{throw s})}async function en(e){if(!e)throw new Error("Missing token");e=e.replace(Qt,"");const t=V.decode(J.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function tn(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function nn(e){return e.kind===Ne}function rn(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function sn(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function Ge(e){const t=X(H.encode(JSON.stringify(e)));return E(t)}function an(e,t){const n=e.tags.find(i=>i[0]==="payload");if(!n)return!1;const r=Ge(t);return n.length>0&&n[1]===r}async function on(e,t,n,r){if(!ue(e))throw new Error("Invalid nostr event, signature invalid");if(!nn(e))throw new Error("Invalid nostr event, kind invalid");if(!tn(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!rn(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!sn(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!an(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const js="npub19djteyezrkn9ppg6gjfsxl59pgxrwh76uju60lxtcvr5svj3cmlsf54ca2",nt=["wss://relay.anmore.me","wss://relay.damus.io","wss://nos.lol","wss://relay.primal.net"];function Gs(e){try{const t=Me.decode(e);return t.type==="npub"?t.data:null}catch{return null}}function Js(e,t){return e>=50?"":e>=25?"":e>=10?"":e>=5?"":""}function Ks(e){const t=[];return e["Trail Building"]>0&&t.push(""),e["Pump Track"]>0&&t.push(""),e["Bike Train"]>0&&t.push(""),e["Bike Clinics"]>0&&t.push(""),t}async function Zs(e){const t=Gs(js);if(!t)throw new Error("Invalid recipient npub");const n=new vi,r=new Map;let i=0;const s=Math.floor(Date.now()/1e3);e==="week"&&(i=s-10080*60),e==="month"&&(i=s-720*60*60);const a=await n.querySync(nt,{kinds:[4],"#p":[t],since:i,limit:1e3});for(const o of a){const c=o.pubkey;if(!r.has(c)){const h=Me.npubEncode(c);r.set(c,{npub:h,displayName:"bikeuser",count:0,formTypes:{},timestamps:[]})}const u=r.get(c);u.count++,u.timestamps.push(o.created_at);const l=o.tags.find(h=>h[0]==="form-type");if(l&&l[1]){const h=l[1];u.formTypes[h]=(u.formTypes[h]||0)+1}}return n.close(nt),r}function Xs(e){const t=document.getElementById("leaderboard-loading"),n=document.getElementById("leaderboard-error"),r=document.getElementById("leaderboard-empty"),i=document.getElementById("leaderboard-list");if(t&&t.classList.add("hidden"),n&&n.classList.add("hidden"),e.size===0){r&&r.classList.remove("hidden"),i&&i.classList.add("hidden");return}r&&r.classList.add("hidden"),i&&i.classList.remove("hidden");const s=Array.from(e.values()).sort((l,h)=>h.count-l.count),a=document.getElementById("total-contributors"),o=document.getElementById("total-submissions"),c=document.getElementById("trail-proposals");if(a&&(a.textContent=e.size.toString()),o){const l=s.reduce((h,d)=>h+d.count,0);o.textContent=l.toString()}if(c){const l=s.reduce((h,d)=>h+(d.formTypes["Trail Building"]||0),0);c.textContent=l.toString()}const u=s.map((l,h)=>{const d=Js(l.count,l.formTypes),f=Ks(l.formTypes),p=[d,...f].join(" ");return`
          <div class="${h===0?"bg-yellow-50":h===1?"bg-gray-50":h===2?"bg-orange-50":"bg-white"} px-6 py-4 hover:bg-green-50 transition">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-4">
                <div class="text-2xl font-bold text-gray-400 w-8">#${h+1}</div>
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center text-2xl">
                  ${d}
                </div>
                <div>
                  <div class="font-bold text-gray-900">${l.displayName}</div>
                  <div class="text-xs text-gray-500 font-mono">${l.npub.slice(0,16)}...</div>
                </div>
              </div>
              <div class="text-right">
                <div class="text-2xl font-bold text-green-600">${l.count}</div>
                <div class="text-xs text-gray-500">contributions</div>
                ${f.length>0?`<div class="text-sm mt-1">${p}</div>`:""}
              </div>
            </div>
          </div>
        `}).join("");i&&(i.innerHTML=u)}function Ys(e){const t=document.getElementById("leaderboard-loading"),n=document.getElementById("leaderboard-error"),r=document.getElementById("error-message");t&&t.classList.add("hidden"),n&&n.classList.remove("hidden"),r&&(r.textContent=e)}let cn="all";async function ln(){try{const e=await Zs(cn);Xs(e)}catch(e){console.error("Failed to load leaderboard:",e),Ys(e instanceof Error?e.message:"Unknown error occurred")}}document.querySelectorAll(".filter-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".filter-btn").forEach(t=>{t.classList.remove("active","bg-green-600","text-white"),t.classList.add("bg-gray-200","text-gray-700","hover:bg-gray-300")}),e.classList.add("active","bg-green-600","text-white"),e.classList.remove("bg-gray-200","text-gray-700","hover:bg-gray-300"),cn=e.dataset.filter||"all",ln()})});ln();
