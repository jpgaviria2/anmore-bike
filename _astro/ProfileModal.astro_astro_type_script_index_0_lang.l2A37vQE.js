import{c as B,d as h,e as E,h as b,a as k}from"./profile.BzHqYqaP.js";import"./aes.Ce_Q33qD.js";const v=document.getElementById("profile-modal"),u=document.getElementById("profile-form"),y=document.getElementById("opt-in"),f=document.getElementById("name-field");y?.addEventListener("change",()=>{y.checked?f?.classList.remove("hidden"):f?.classList.add("hidden")});u?.addEventListener("submit",e=>{e.preventDefault();const n=new FormData(u),s=n.get("optIn")==="on",o=n.get("name")||"bikeuser",t=n.get("contact"),d=n.get("bio"),m=[];n.getAll("interests").forEach(I=>{m.push(I)});const g=B();h(g.secretKey);const p={name:s?o:"bikeuser",optIn:s,contact:t||void 0,bio:d||void 0,interests:m,npub:g.npub,createdAt:Date.now()};E(p),v?.classList.add("hidden"),window.dispatchEvent(new CustomEvent("profile-created",{detail:p}))});const L=document.getElementById("nsec-modal"),a=document.getElementById("nsec-display"),i=document.getElementById("copy-nsec"),C=document.getElementById("show-qr"),D=document.getElementById("close-nsec"),w=document.getElementById("qr-code");i?.addEventListener("click",()=>{const e=a?.textContent;e&&(navigator.clipboard.writeText(e),i.textContent="Copied!",setTimeout(()=>{i.textContent="Copy Key"},2e3))});C?.addEventListener("click",()=>{w?.classList.toggle("hidden")});D?.addEventListener("click",()=>{L?.classList.add("hidden"),w?.classList.add("hidden")});const r=document.getElementById("login-modal"),l=document.getElementById("login-form"),c=document.getElementById("login-error"),x=document.getElementById("cancel-login");l?.addEventListener("submit",e=>{e.preventDefault();const s=new FormData(l).get("nsec"),o=b(s);if(!o){c?.classList.remove("hidden");const d=c?.querySelector("p");d&&(d.textContent="Invalid nsec key. Please check and try again.");return}h(o.secretKey);let t=k();(!t||t.npub!==o.npub)&&(t={name:"bikeuser",optIn:!1,interests:[],npub:o.npub,createdAt:Date.now()},E(t)),r?.classList.add("hidden"),c?.classList.add("hidden"),window.dispatchEvent(new CustomEvent("user-logged-in",{detail:t})),alert("Logged in successfully!")});x?.addEventListener("click",()=>{r?.classList.add("hidden"),c?.classList.add("hidden"),l?.reset()});window.showProfileModal=()=>{v?.classList.remove("hidden")};window.showNsecModal=e=>{a&&(a.textContent=e),L?.classList.remove("hidden")};window.showLoginModal=()=>{r?.classList.remove("hidden")};
